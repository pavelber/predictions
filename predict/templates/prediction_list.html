{% extends "base.html" %}
{% block title %}Arg You!{% endblock %}
{% block head %}

{% endblock %}
{% block content %}

    <div id="selectors">
        Filter wagers:
        <select id="ownership_selector" onchange="select_changed(false)">
              {% if logged_in %}<option value="my">My</option>{% endif %}
            <option value="all">All</option>
        </select>
        <select id="status_selector" onchange="select_changed(false)">
            <option value="open">Open</option>
            <option value="all">All</option>
            <option value="closed">Closed</option>
        </select>
        <select id="date_selector" onchange="select_changed(false)">
            <option value="future">Future dates</option>
            <option value="past">Past dates</option>
            <option value="all">All</option>
        </select>
    </div>
    <div id="predictions">
    </div>
    <script>

        function put_data(refresh_if_no, data) {
            const p_div = $("#predictions");
            p_div.empty();
            for (var i in data.predictions) {
                const p = data.predictions[i];
                p_div.append('<div style="grid-column: 1"><a href="{% url "prediction" %}'+p.pid+'">' + p.title + '</a></div>');
                p_div.append('<div>' + p.date + '</div>');
                p_div.append('<div>' + p.prediction_occurred + '</div>');
                p_div.append('<div>' + p.role + '</div>');
            }
            if (data.predictions.length === 0 && refresh_if_no){
                if ($("#ownership_selector").val()!=="all"){
                    $("#ownership_selector").val("all");
                    select_changed();
                } else if ($("#status_selector").val()!=="all"){
                    $("#status_selector").val("all");
                    select_changed();
                } else if ($("#date_selector").val()!=="all"){
                    $("#date_selector").val("all");
                    select_changed();
                }
            }

        }

        function select_changed(refresh_if_no) {
            const put_data_bind = put_data.bind(null,refresh_if_no)
            $.ajax({
                dataType: 'json',
                url: "{% url "filtered_prediction_list" %}" +
                "?status=" + $("#status_selector").val()
                + "&role=" + $("#ownership_selector").val()
                + "&date=" + $("#date_selector").val(),
                success: put_data_bind
            });
        }

        $(document).ready(function () {
            select_changed(true)
        });
    </script>
{% endblock %}